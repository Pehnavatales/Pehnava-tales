<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Payment - Pehnava Tales</title>
<style>
  body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:#fff8f0; color:#5a3d2b; margin:0; padding:0; }
  header { background:#f8f0e3; padding:10px 20px; border-bottom:1px solid #d3bfa7; display:flex; align-items:center; }
  .logo { font-size:24px; font-weight:700; color:#c55e35; cursor:pointer; }
  .container { max-width:600px; margin:30px auto; padding:20px; background:white; border-radius:10px; box-shadow:0 3px 8px rgba(197,94,53,0.3); }
  h2 { color:#c55e35; text-align:center; margin-bottom:10px; }
  .amount-box { font-weight:700; font-size:20px; color:#a35224; text-align:center; margin-bottom:14px; }
  .details { margin-bottom:12px; line-height:1.4; }
  label { display:block; font-weight:600; margin-top:10px; }
  select, input[type="text"], input[type="password"], input[type="month"], input[type="tel"] {
    width:100%; padding:8px; font-size:14px; border-radius:5px; border:1px solid #c9b6a3; margin-top:6px;
  }
  #cardDetails { display:none; margin-top:10px; }
  #upiBox { display:none; margin-top:12px; font-weight:600; color:#5a3d2b; }
  button { margin-top:18px; width:100%; padding:12px; background:#c55e35; color:white; border:none; border-radius:6px; font-weight:700; font-size:16px; cursor:pointer; }
  button:hover { background:#a35224; }
  .success { color:green; font-weight:700; text-align:center; margin-top:12px; }
</style>
</head>
<body>

<header>
  <div class="logo" onclick="location.href='index.html'">Pehnava Tales</div>
</header>

<div class="container">
  <h2>Payment</h2>

  <div class="amount-box" id="amountBox">Total: ₹0</div>

  <div class="details" id="shippingDetails"></div>

  <form id="paymentForm">
    <label>Choose Payment Method</label>
    <label><input type="radio" name="method" value="COD" checked /> Cash on Delivery</label>
    <label><input type="radio" name="method" value="UPI" /> UPI</label>
    <label><input type="radio" name="method" value="Card" /> Card</label>

    <div id="upiBox">
      <p>Scan/Pay with your UPI app to: <strong>pehnavatales@upi</strong></p>
      <p>After paying, enter your UPI transaction ID (optional):</p>
      <input id="upiId" placeholder="yourupi@bank or txn id (optional)" />
    </div>

    <div id="cardDetails">
      <label for="cardName">Cardholder Name</label>
      <input id="cardName" type="text" placeholder="Name on card" />

      <label for="cardNumber">Card Number</label>
      <input id="cardNumber" type="text" maxlength="19" placeholder="XXXX XXXX XXXX XXXX" />

      <label for="cardExpiry">Expiry</label>
      <input id="cardExpiry" type="month" />

      <label for="cardCVV">CVV</label>
      <input id="cardCVV" type="password" maxlength="3" placeholder="3-digit CVV" />
    </div>

    <button type="submit" id="confirmBtn">Confirm Payment</button>
  </form>

  <div class="success" id="successMsg" style="display:none;"></div>
</div>

<script>
  // read checkout data & amount
  const checkoutData = JSON.parse(localStorage.getItem('checkoutData') || 'null');
  const amount = localStorage.getItem('paymentAmount') || '0';

  // redirect back if missing
  if (!checkoutData || amount === '0' || amount === 0) {
    // If cart/checkout missing, better to send user back to cart/checkout
    // but don't annoy — show alert and redirect to checkout
    // (user may come from cart -> checkout normally)
    alert('No order data found. Please go through checkout.');
    window.location.href = 'checkout.html';
  }

  // show amount and shipping details
  document.getElementById('amountBox').textContent = `Total: ₹${amount}`;
  const shippingDetailsDiv = document.getElementById('shippingDetails');
  shippingDetailsDiv.innerHTML = `
    <strong>Shipping To:</strong><br>
    ${checkoutData.name}<br>
    ${checkoutData.address1}${checkoutData.address2 ? ', ' + checkoutData.address2 : ''}<br>
    ${checkoutData.city}, ${checkoutData.state} - ${checkoutData.pincode}<br>
    Phone: ${checkoutData.phone}<br>
    Email: ${checkoutData.email}
  `;

  // payment method UI logic
  const methodRadios = document.querySelectorAll('input[name="method"]');
  const cardDetails = document.getElementById('cardDetails');
  const upiBox = document.getElementById('upiBox');

  methodRadios.forEach(r => r.addEventListener('change', () => {
    if (r.value === 'Card' && r.checked) {
      cardDetails.style.display = 'block';
      upiBox.style.display = 'none';
    } else if (r.value === 'UPI' && r.checked) {
      cardDetails.style.display = 'none';
      upiBox.style.display = 'block';
    } else if (r.value === 'COD' && r.checked) {
      cardDetails.style.display = 'none';
      upiBox.style.display = 'none';
    }
  }));

  // submit / simulate
  document.getElementById('paymentForm').addEventListener('submit', function(e){
    e.preventDefault();
    const method = document.querySelector('input[name="method"]:checked').value;

    if (method === 'Card') {
      const cName = document.getElementById('cardName').value.trim();
      const cNum = document.getElementById('cardNumber').value.replace(/\s+/g, '');
      const cExp = document.getElementById('cardExpiry').value.trim();
      const cCvv = document.getElementById('cardCVV').value.trim();

      if (!cName || !cNum || !cExp || !cCvv) {
        alert('Please fill all card details.');
        return;
      }
      if (!/^\d{16}$/.test(cNum)) {
        alert('Enter valid 16-digit card number.');
        return;
      }
      if (!/^\d{3}$/.test(cCvv)) {
        alert('Enter valid 3-digit CVV.');
        return;
      }
      // expiry basic check (month available)
    }

    if (method === 'UPI') {
      // optional prompt handled by field; we won't require it
    }

    // simulate processing
    document.getElementById('successMsg').style.display = 'block';
    document.getElementById('successMsg').textContent = 'Processing payment...';

    setTimeout(() => {
      document.getElementById('successMsg').textContent = `Payment successful (${method}). Thank you!`;
      // clear cart & saved checkout
      localStorage.removeItem('cart');
      localStorage.removeItem('checkoutData');
      localStorage.removeItem('paymentAmount');

      // redirect to home after short delay
      setTimeout(() => location.href = 'index.html', 2500);
    }, 1200);
  });
</script>

</body>
</html>
